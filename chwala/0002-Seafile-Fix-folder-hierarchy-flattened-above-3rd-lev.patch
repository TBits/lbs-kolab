From b58c8aedbd73062b36624521fd9ca89fbfa028bd Mon Sep 17 00:00:00 2001
From: Aleksander Machniak <machniak@kolabsys.com>
Date: Wed, 20 Mar 2019 11:54:55 +0100
Subject: [PATCH 2/2] Seafile: Fix folder hierarchy flattened above 3rd level
 (Bifrost#T193526)

---
 lib/drivers/seafile/seafile_file_storage.php | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/lib/drivers/seafile/seafile_file_storage.php b/lib/drivers/seafile/seafile_file_storage.php
index 6edc5fc..e7fbe88 100644
--- a/lib/drivers/seafile/seafile_file_storage.php
+++ b/lib/drivers/seafile/seafile_file_storage.php
@@ -1494,7 +1494,7 @@ class seafile_file_storage implements file_storage
         if (empty($params['recursive']) && empty($params['level'])) {
             if ($content = $this->api->directory_entries($library['id'], $root, 'dir', true)) {
                 foreach ($content as $item) {
-                    $add_folder($item, $folders, $root);
+                    $add_folder($item, $folders, trim($item['parent_dir'], '/'));
                 }
             }
         }
-- 
2.20.1

