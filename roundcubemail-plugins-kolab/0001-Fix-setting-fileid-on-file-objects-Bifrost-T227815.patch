From 6ba98384670aafbe0895b81aea7bb9bf32d7ced1 Mon Sep 17 00:00:00 2001
From: Aleksander Machniak <machniak@kolabsys.com>
Date: Mon, 15 Jul 2019 11:21:30 +0000
Subject: [PATCH 1/3] Fix setting 'fileid' on file objects (Bifrost#T227815)

---
 plugins/libkolab/lib/kolab_storage_cache_file.php | 13 +++++--------
 1 file changed, 5 insertions(+), 8 deletions(-)

diff --git a/plugins/libkolab/lib/kolab_storage_cache_file.php b/plugins/libkolab/lib/kolab_storage_cache_file.php
index 1f3d4d92..b62c0f7a 100644
--- a/plugins/libkolab/lib/kolab_storage_cache_file.php
+++ b/plugins/libkolab/lib/kolab_storage_cache_file.php
@@ -61,15 +61,12 @@ class kolab_storage_cache_file extends kolab_storage_cache
     {
         $object = parent::_unserialize($sql_arr);
 
-        if ($object && $sql_arr['fast-mode']) {
-            if (!empty($object['_attachments'])) {
-                $file = $object['_attachments'][key($object['_attachments'])];
+        if ($object && !empty($object['_attachments'])) {
+            $file = $object['_attachments'][key($object['_attachments'])];
 
-                $object['type']     = $file['mimetype'];
-                $object['size']     = $file['size'];
-                $object['fileid']   = $file['id'];
-                $object['filename'] = $file['name'];
-            }
+            $object['type']   = $file['mimetype'];
+            $object['size']   = $file['size'];
+            $object['fileid'] = $file['id'];
         }
 
         return $object;
-- 
2.21.0

