#!/usr/bin/make -f
# -*- makefile -*-
# Sample debian/rules that uses debhelper.
# This file was originally written by Joey Hess and Craig Small.
# As a special exception, when this file is copied by dh-make into a
# dh-make output file, you may use that output file without restriction.
# This special exception was added by Craig Small in version 0.37 of dh-make.

# Uncomment this to turn on verbose mode.
export DH_VERBOSE=1

%:
	dh $@

override_dh_auto_configure:
	if [ -f "/etc/plesk-release" ]; then \
		sed -i -e 's/www-data adm/roundcube_sysuser roundcube_sysgroup/g' debian/kolab-syncroton.logrotate ; \
	fi

override_dh_install:
	mkdir -p debian/tmp
	dh_install --list-missing -XLICENSE

	mkdir -p $(CURDIR)/debian/kolab-syncroton/etc/roundcubemail
	cp -a config/config.inc.php.dist $(CURDIR)/debian/kolab-syncroton/etc/roundcubemail/kolab_syncroton.inc.php

	if [ ! -f "/etc/plesk-release" ]; then \
        cp -v ../SOURCES/plesk.kolab_syncroton.inc.php $(CURDIR)/debian/kolab-syncroton/etc/roundcubemail/kolab_syncroton.inc.php; \
		mkdir -p $(CURDIR)/debian/kolab-syncroton/etc/apache2/sites-available ; \
		install -pm 644 $(CURDIR)/docs/kolab-syncroton.conf \
			$(CURDIR)/debian/kolab-syncroton/etc/apache2/sites-available/kolab-syncroton.conf ; \
		echo "misc:Depends=roundcubemail-plugin-kolab-auth (>= 3.1.12)" >> $(CURDIR)/debian/kolab-syncroton.substvars ; \
	fi

	# Some PHP files seem to be executable
	find debian/kolab-syncroton/usr/share/kolab-syncroton/lib -type f -name "*php" -perm +1 -print0 | xargs -r0 chmod -x

override_dh_compress:
	dh_compress -X.sql
