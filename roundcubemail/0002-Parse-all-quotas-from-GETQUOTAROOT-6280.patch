From 7dfbb62b78e3949daa8e49db9ebed46ddd8f964e Mon Sep 17 00:00:00 2001
From: Edgaras L <edgaras.lukosevicius@gmail.com>
Date: Sat, 5 May 2018 13:48:15 +0300
Subject: [PATCH 2/5] Parse all quotas from GETQUOTAROOT (#6280)

---
 program/lib/Roundcube/rcube_imap_generic.php | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/program/lib/Roundcube/rcube_imap_generic.php b/program/lib/Roundcube/rcube_imap_generic.php
index 3899b235e..61564bb1a 100644
--- a/program/lib/Roundcube/rcube_imap_generic.php
+++ b/program/lib/Roundcube/rcube_imap_generic.php
@@ -3125,8 +3125,9 @@ class rcube_imap_generic
                 if (preg_match('/^\* QUOTA /', $line)) {
                     list(, , $quota_root) = $this->tokenizeResponse($line, 3);
 
-                    while ($line) {
-                        list($type, $used, $total) = $this->tokenizeResponse($line, 1);
+                    $quotas = $this->tokenizeResponse($line, 1);
+                    foreach (array_chunk($quotas, 3) as $quota) {
+                        list($type, $used, $total) = $quota;
                         $type = strtolower($type);
 
                         if ($type && $total) {
-- 
2.14.3

