From 9efd534fe1195f27eaee851a99421934d0954090 Mon Sep 17 00:00:00 2001
From: Aleksander Machniak <alec@alec.pl>
Date: Tue, 3 Apr 2018 18:19:07 +0200
Subject: [PATCH 2/4] Fix PHP 7.2: count(): Parameter must be an array in
 enchant-based spellchecker (#6234)

---
 CHANGELOG                                          | 1 +
 program/lib/Roundcube/rcube_spellcheck_enchant.php | 4 ++--
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/CHANGELOG b/CHANGELOG
index 650f679a6..bbb709bcb 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -2,6 +2,7 @@ CHANGELOG Roundcube Webmail
 ===========================
 
 - Fix parsing date strings (e.g. from a Date: mail header) with comments (#6216)
+- Fix PHP 7.2: count(): Parameter must be an array in enchant-based spellchecker (#6234)
 
 RELEASE 1.3.5
 -------------
diff --git a/program/lib/Roundcube/rcube_spellcheck_enchant.php b/program/lib/Roundcube/rcube_spellcheck_enchant.php
index b2a86db76..8c5f801a6 100644
--- a/program/lib/Roundcube/rcube_spellcheck_enchant.php
+++ b/program/lib/Roundcube/rcube_spellcheck_enchant.php
@@ -101,7 +101,7 @@ class rcube_spellcheck_enchant extends rcube_spellcheck_engine
             else if (!enchant_dict_check($this->enchant_dictionary, $word)) {
                 $suggestions = enchant_dict_suggest($this->enchant_dictionary, $word);
 
-                if (count($suggestions) > self::MAX_SUGGESTIONS) {
+                if (is_array($suggestions) && count($suggestions) > self::MAX_SUGGESTIONS) {
                     $suggestions = array_slice($suggestions, 0, self::MAX_SUGGESTIONS);
                 }
 
@@ -130,7 +130,7 @@ class rcube_spellcheck_enchant extends rcube_spellcheck_engine
 
         $suggestions = enchant_dict_suggest($this->enchant_dictionary, $word);
 
-        if (count($suggestions) > self::MAX_SUGGESTIONS)
+        if (is_array($suggestions) && count($suggestions) > self::MAX_SUGGESTIONS)
             $suggestions = array_slice($suggestions, 0, self::MAX_SUGGESTIONS);
 
         return is_array($suggestions) ? $suggestions : array();
-- 
2.14.3

